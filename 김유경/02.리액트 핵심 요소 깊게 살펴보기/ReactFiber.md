# 리액트 파이버(Fiber)

React가 렌더링을 관리하는 내부 엔진 구조

- React Fiber는 React 16부터 도입된 새로운 재조정(Reconciliation) 아키텍처이다.

## 핵심 목적

1. 렌더링 작업을 쪼개고, 스케줄링할 수 있게 만든 것
2. 각 컴포넌트의 상태와 훅 정보를 저장하기 위한 단위(노드)를 마련하는 것

#### React Fiber는

- 렌더링 엔진
- 리액트 컴포넌트 트리의 내부 표현체
- 각 컴포넌트의 상태 저장 공간

이라고 할 수 있다.

## Fiber는 리액트 컴포넌트 하나하나를 표현하는 객체

React는 컴포넌트마다 "Fiber Node"라는 객체를 하나씩 만든다.

#### Fiber Node 안에 들어가는 정보

- 해당 컴포넌트의 타입(함수인지 div인지 등)
- 해당 컴포넌트의 props
- 해당 컴포넌트의 state (useState 값들)
- 해당 컴포넌트의 Hooks 정보 (memoizedState)
- 자식/형제 Fiber 링크 (트리구조)
- 부모/자식 관계
- DOM 정보
- 업데이트 정보
  즉, Fiber는 React가 컴포넌트를 이해하고, 상태를 보관하고, 렌더링을 관리하기 위한 구조체이다.

## Fiber = "작업 단위 + 컴포넌트 상태 저장소"

컴포넌트가 렌더링되면 함수는 매번 새로 실행된다
-> 그런데 state는 유지되어야 한다

#### ❓이 유지되는 state가 어디 저장되어 있을까?

= **Fiber.memoizedState** 안에 저장되어 있다.

useState가 호출될 때마다 React는 다음을 실행한다.

1. 현재 실행 중인 Fiber를 찾는다
2. 그 Fiber의 memoizedState(훅 저장소)에 순서대로 저장한다
3. 다음 렌더링에서도 같은 순서로 다시 값을 꺼낸다

#### 💡왜 훅은 순서가 중요하다고 했는지 알겄나!?

React는 훅을 Fiber에 '순서 기반 Linked List'로 저장하기 때문 !

- 조건문 안에서 useState 순서가 바뀌면 React가 어떤 state인지 알아볼 수 없다

## 파이버가 없다면 상태를 유지할 수 없다

## 파이버는 '시간 분할 렌더링'의 핵심

React 15버전 이하에서는 렌더링이 "한 번에 쭉" 끝날 때까지 멈출 수 없었다.
=> 큰 컴포넌트 트리를 렌더링하면 브라우저 멈춤

Fiber 도입 이후

- 렌더링 작업을 작은 단위로 쪼개고,
- 우선순위 높은 작ㅇ버을 먼저 처리 (사용자 입력 같은)
- 나머지는 나중에 처리 (무거운 렌더링)
  => 즉, React는 비동기적이고 협력적인 스케줄링을 할 수 있게 됐다.
