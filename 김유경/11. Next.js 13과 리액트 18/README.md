Next.js 13 버전은 레이아웃과 서버 컴포넌트, SWC 및 Turbopack 도입 등 역대 가장 큰 변화를 포함하고 있는 버전이지요

# 11.1 app 디렉토리의 등장
기존 Next.js의 한계였던 layout 시스템을 극복하기 위해 `/app` 디렉토리가 도입되었다.
이전에는 `_app`과 `_document`를 통해서만 공통 영역을 설정할 수 있었지만, 이때부터 각 라우트별로 유연한 레이아웃 구성이 가능해짐

## 11.1.1 라우팅
라우팅이란?
- 파일명 기반이 아닌, 폴더명이 주소가 되며, 폴더 내 예약어 파일 (`page.js`, `layout.js` 등)로 페이지와 구조를 정의

layout.js
- 공통 UI를 담당하며, 리렌더링되지 않고 상태를 유지
    - 루트 레이아웃은 `html`, `body` 태그를 포함해야 하며, `_app`과 `_document`를 대체

page.js
- 실제 페이즈 콘텐츠를 담고, `params`와 `searchParams`를 props로 받음

error.js
- 해당 라우트 영역의 에러 핸들링을 담당하는 클라이언트 컴포넌트

loading.js
- 리액트의 Suspense를 기반으로 데이터 로딩 시 보여줄 UI를 정의

route.js
- API 엔드 포인트를 정의하며, GET, POST 등 HTTP 메서드명을 함수로 선언

# 11.2 리액트 서버 컴포넌트 (RSC)
서버 컴포넌트는 서버와 클라이언트 모두에서 컴포넌트를 렌더링할 수 있는 새로운 기법

## 11.2.1 기존 리액트 컴포넌트와 서버 사이드 렌더링의 한계
- 자바스크립트 번들 크기 : 클라이언트에서 무거운 라이브러리를 다운로드해야 하는 부담이 있음
- 백엔드 리소스 접근 : DB 등에 직접 접근할 수 없어 항상 API를 거쳐야 했음
- 자동 코드 분할 : `React.lazy` 등을 수동으로 설정해야 해서 번거로움

## 11.2.2 서버 컴포넌트란?
서버 컴포넌트
- 서버에서 실행되며 상태(`state`)나 생명주기(`effect`)를 가질 수 없지만, DB나 파일 시스템에 직접 접근이 가능

클라이언트 컴포넌트
- `"use client"` 지시자를 사용하며, 브라우저 API와 리액트 훅을 사용할 수 있음

공용 컴포넌트
- 서버/클라이언트 양쪽 모두에서 실행 가능하며, 양측의 제약을 모두 받음

# 11.3 Next.js에서의 리액트 서버 컴포넌트
Next.js 13은 `/app` 디렉토리를 통해 서버 컴포넌트를 기본값으로 지원

## 11.3.1 새로운 fetch 도입
- `getServerSideProps`, `getStaticProps` 등이 삭제되고 표준 API인 `fetch`로 통합
- 요청 중복 제거
    - 동일한 서버 컴포넌트 트리 내에서 중복된 `fetch` 요청은 자동으로 캐싱(Deduplication)

## 11.3.2 정적 렌더링과 동적 렌더링
정적 렌더링
- 빌드 시 결과를 캐싱하여 재사용

동적 렌더링
- 요청 시마다 서버에서 렌더링하며, `fetch` 옵션(`no-store`)이나 쿠키/헤더 사용 시 자동으로 동적 렌더링으로 전환

generateStaticParams
- 과거의 `getStaticPaths`와 유사하게 정적 파라미터를 미리 생성

## 11.3.4 스트리밍을 활용한 점진적인 페이지 불러오기
HTML을 작은 단위로 쪼개 완성되는 대로 클라이언트에 보내는 스트리밍을 통해 TTFB와 FCP를 개선
- `loading.js`나 `Suspense`를 사용하여 구현

# 11.5 서버 액션 (Alpha)
API를 생성하지 않고 함수 수준에서 서버에 직접 접근하여 데이터를 처리(Mutation)할 수 있는 기능
- `"use server"` 지시자를 사용하며 반드시 `async` 함수여야 함
- from action : `<form action={handleSubmit}>` 형태로 서버 액션을 직접 연결할 수 있음
- server mutation : `revalidatePath`, `revalidateTag`, `redirect` 등을 통해 캐시를 갱신하거나 페이지를 이동