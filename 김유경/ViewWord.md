스터디를 계속해서 진행하면서,

렌더링, 리렌더링, DOM 업데이트 등 화면 업데이트와 관련된 용어들이 너무 헷갈려서 한 번 정리하고 가려고 합니다.

우선 이 헷갈림, 혼란을 정리하기 위해서 리액트의 **Render phase(계산)** 과 **Commit phase(반영)** 을 중심으로 정리를 해보겠습니다.

### 리액트의 렌더링은 '계산' `Render Phase`

렌더링이라는 용어만 보면 화면을 그린다는 의미로 받아들여지기 쉬운데, 리액트 엔진 입장에서 렌더링은 **이전 화면과 비교해서 무엇을 바꿔야할 지 계산하는 과정** 이다

- 렌더링(Rendering) : 컴포넌트 함수를 호출해서 새로운 가상 DOM 스냅샷을 만드는 과정
- 리렌더링(Re-rendering) : 상태(State)나 Props가 변해서 컴포넌트를 '다시' 실행하는 것
- React Fiber : 리액트의 렌더링 알고리즘 단위
  - `memoizedState`는 이 파이버 객체 안에 저장된 "기존 상태 데이터"이고, 리액트는 이를 새 데이터와 비교하면서 변경 사항이 있는지 확인합니다

### 화면에 반영하는 단계 `Commit Phase`

계산이 끝났다면, 이제 실제 브라우저에 화면을 적용해야겠지요?
이 단계를 바로 커밋(Commit)이라고 부릅니다.

- DOM 업데이트 : 리액트가 계산한 변경 사항을 실제 브라우저 DOM 노드에 주입하는 행위입니다
  => 여기서 중요한 건, 이때까지도 아직 우리의 눈에 안보일 수 있습니다.

- 브라우저 렌더링 (Painting) : 브라우저가 변경된 DOM을 바탕으로 레이아웃을 계산하고 실제 픽셀을 화면에 그리는 과정입니다.

### 헷갈리는 Hook들의 타이밍 정리 시간 ~!

- 렌더링 직전에 실행되는 `useLayoutEffect` 부터해서 많잖아요?

| 단계         | 발생 작업                     | 관련 Hook            |
| ------------ | ----------------------------- | -------------------- |
| Render Phase | 컴포넌트 호출, 가상 DOM 비교  | (없음 - 순수해야 함) |
| Commit Phase | 실제 DOM에 변경사항 반영      | -                    |
| Pre-Paint    | 브라우저가 화면을 그리기 직전 | `useLayoutEffect`    |
| Paint        | 사용자가 화면을 봄            | -                    |
| Post-Paint   | 화면이 그려진 직후            | `useEffect`          |

- useLayoutEffect : DOM 업데이트는 끝났지만, 브라우저가 화면을 그리기(Paint) 직전에 실행됩니다. 그래서 여기서 DOM 수치를 조작해도 사용자는 깜빡임을 느끼지 못합니다.
- useEffect: 브라우저가 화면을 다 그린 후에 실행됩니다. 데이터 패칭이나 로그 전송처럼 화면을 가로막지 않아도 되는 작업에 사용합니다.

#### Next.js와 연결해본다면?

서버 사이드 환경에선 useEffect나 useLayoutEffect 등을 사용할 수 없지 않습니까?
그것은 해당 훅들의 실행 시점을 본다면 당연한 것임을 알 수 있었습니다 -!

- 서버 사이드 렌더링은 서버에 있는 Node.js가 리액트 컴포넌트를 실행해봅니다. 하지만, 서버에는 브라우저 화면이 없죠? 그래서 결과물을 HTML 문자열로 만들어서 브라우저에 던져주는 것입니다
- 서버에는 화면을 그리는 과정 자체가 없기 때문에 해당 훅이 실행되지 않는 것입니다 -!
