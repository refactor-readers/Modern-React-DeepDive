# 13.1 애플리케이션에서 확인하기

## 13.1.1 create-react-app

### web-vitals

- 웹 성능 측정을 위한 라이브러리
- PerformanceObserver라는 브라우저 API를 사용함
- 브라우저에서 API 지원하지 않으면 사용이 어려움

## 13.1.2 create-nextapp

### NextWebVitalMetric

- Next.js에서 제공하는 성능측정 메서드
- 핵심 웹 지표 외에도 Next.js 전용 사용자 지표도 제공함
    - Next.js-hydration: 하이드레이션 하는데 걸린시간
    - Next.js-route-change-to-render: 라우트 변경 후 렌더링 시작까지 걸린 시간
    - Next.js-render: 라우트 변경완료 후 페이지 렌더링하는데 걸린 시간

---

# 13.2 구글 라이트 하우스

- 별도 코드 수정이나 배포, 인스톨 없이도 지표를 측정할 수 있음
- 확장 프로그램이나 크롬 개발자도구에서 사용할 수 있음
- npm 라이브러리도 있어서 CLI로도 실행이 가능함

## 13.2.1 탐색모드

- 페이지 접속부터 로딩 완료까지 성능을 측정하는 모드
- 측정 시작 시 페이지를 처음부터 다시 불러옴

### 성능

- FCP, LCP, CLS 등의 지표
- Time to Interactive: 사용자가 완전히 상호작용 할 수 있을때까지 걸리는 시간
- Speed Index: 콘텐츠가 얼마나 빨리 시각적으로 표시되는지
- Total Blocking Time: 메인스레드에서 50ms 이상 실행되는 작업에 걸린 시간 모음
(50ms 초과분)

### 접근성

- 장애인 및 고령자 등 신체적으로 불편한 사람들이 일반사용자와 동등하게 웹페이지를 이용할 수 있도록 하는것
- 스크린리더, 자막, 키보드 접근성 등의 지원 여부

### 권장사항

권장사항에는 보아, 표준 모드, 최신 라이브러리, 소스맵 등 다양한 요소가 있음

### 검색 엔진 최적화

- 구글과 같은 검색엔진이 웹페이지 정보를 쉽게 가젹서 공개할 수 있도록 함
- 크롤링 효율부터 robots.txt 유효 여부, 시맨틱태그, 메타태그 등을 확인함
- 최적화되어 있으면 검색결과에서 우선순위를 가질 수 있음

## 13.2.2 기간 모드

- 시작, 종료를 직접 할 수 있음
- 측정 기간동안 성능 측정을 원하는 작업을 수행해서 측정할 수 있음

### 흔적(View Trace)

- 성능을 추적한 기간을 보여줌
- 시간에 흐름에 따라 웹페이지 로딩 정도를 보여줌

### 트리맵

- 페이지 로드할 때 함께 로딩한 모든 리소스를 볼 수 있음
- 전체 JS 리소스들의 전체 데이터 대비 비율과 실제 크기를 확인할 수 있음
- 실제로 불러왔지만 사용되지 않은 리소스도 확인할 수 있음
- 개발자 도구 소스 탭에서 파일명으로 검색해 실제 소스코드 확인이 가능하니, 비중이 큰 리소스는 한번 검토해보자

## 13.2.3 스냅샷

- 현재 페이지 상태를 기준으로 분석함
- 현재 상태에서의 SEO, 접근성, 성능 등을 분석
- 로딩 이외에 특정 페이지의 특정 상태에서 분석을 원하는 경우 사용
- 지표는 탐색모드와 동일함

---

# 13.3 WebPageTest

가장 널리 알려진 웹사이트 성능 분석 도구

유료기능도 있음, 무료기능으로도 충분함

### 주요 분석도구

- **Site Performance**: 사이트 성능 분석
- Core Web Vitals: 핵심 웹 지표 확인
- Lighthouse: 구글 라이트하우스
- Visual Comparison: 2개 이상의 사이트를 동시 실행해 로딩 과정을 비교
- Traceroute: 네트워크 경로를 확인

책에서는 Site Performance 활용에 대해 다루고 있음

## 13.3.1 Performance Summary

- Site Performance 분석 실행 후 결과를 요약해서 볼 수 있음
- 성능 테스트는 총 3번 이루어지고, 3개의 결과를 확인할 수 있음

### 측정 결과

- Opportunities & Experiments
    - 웹사이트에 대한 평가를 총 3가지로 나누어 보여줌
    - Is it Quick: 웹사이트가 충분히 빠른지(TTFB, LCP, FCP 등)
    - Is it Usable: 사용성, 시각적 요소 확인(CLS, Time to Interactive..)
    - Is it Resilient: 보안 취약성 점검, 렌더링 블로킹하는 라이브러리 여부, 보안 위혐 등
- Observed Metrics
    - TTFB, FCP, 렌더링 시작에 소요되는 시간 등 지표를 측정함
    - 시간흐름에 따라 웹페이지가 어떻게 렌더링됐는지도 볼 수 있음
- Individual Runs
    - WebPageTest는 3번의 테스트 후 평균값을 보여줌
    - 각 케이스별로도 결과를 확인할 수 있음

## 13.3.2 Opportunities & Experiments

- TTFB 점검, 빠빠좋
- 렌더링을 블로킹하는 자바스크립트 있는지 확인
- 렌더링을 블로킹하는 CSS가 있는지 확인
- FCP가 2.5초 이내인지 확인, 개선방안도 제안해줌
- lazy load 되는 이미지가 있는지 확인
- 주요 영역 외에 lazy load 되는 이미지 확인
- 텍스트 노출을 지연시키는 커스텀 폰트 여부 확인
- 제3자 호스트에서 폰트를 불러오는지 확인
- 실제 사용하지 않는 리소스를 preload 하는지 확인
- HTTP 리다이렉트되는 리소스 확인
- 최초 HTML, 최종 HTML 차이 비교
- Is it Usable
    - 이미지 비율(사이즈) 부재로 인한 layout shift 가능성 여부 확인
    - 메인스레드 블로킹 여부 확인
    - meta 데이터에 viewport가 적절히 설정되었는지 확인
    - 접근성 이슈 확인, 수정 필요 시 힌트 제공
- Is it Resilient
    - 렌더링을 막는 제3자 라이브러리 요청이 없는지 확인
    - 외부 응답을 기다려서 발생하는 성능저하에 대한 경고
    - Synk에서 검출된 보안 위협 확인
    - HTTPS 사용 여부 확인

## 13.3.3 Filmstrip

- 웹사이트를 필름처럼 시간에 따라 어떻게 그려지는지 확인할 수 있음
- 타임라인으로 시간에 따라 불러온 리소스도 확인할 수 있음
- 리소스를 불러오는 순서를 확인해서, 주요 컨텐츠를 우선적으로 로드하도록 힌트를 얻을 수 있음

## 13.3.4 Details

- Filmstrip의 내용을 좀 더 자세하게 보여줌

## 13.3.5 Web Vitals

- LCP, CLS, TBT(Total Blocking Time)에 대한 자세한 정보 제공

## 13.3.6 Optimizations

- 리소스들이 얼마나 최적화 되어있는지 나타냄
- Keep-Alive - 서버와 연결 유지 여부
- Gzip - 리소스 압축 여부
- 이미지 적절한 압축 여부
- Progressive JPEG로 JPEG이미지 렌더링 여부
- 리소스 캐시 정책 적절성 확인
- 리소스 CDN 연결 여부

☝️ Progressive JPEG??

- 적은 데이터로 이미지 전체를 낮은 해상도로 구현함
- 이후 데이터 로딩 정도에 따라 이미지 전체를 로드함
- Layout shift 예방에 효과적

## 13.3.7 Content

- 컨텐츠, 애셋을 종류별로 나눠서 보여줌
- 컨텐츠 종류별 크기, 로딩과정, 시간흐름에 따른 로드 히스토리를 확인할 수 있음

## 13.3.8 Domains

- 애셋들이 어느 도메인에서 왔는지, 도메인별로 구분

## 13.3.9 Console Log

- 사용자 접속 시 콘솔에 무엇이 기록됐는지 확인
- console.log는 안쓰는게 좋음

## 13.3.10 Detected Technologies

- 개발에 사용된 기술 확인

## 13.3.11 Main-thread Processing

- 메인스레드에서 처리한 작업 확인
- 유휴시간은 포함되지 않음
- 작업들을 크게 다섯 가지로 분류해서 알려줌
    - 실행(Scripting)
    - 레이아웃(Layout)
    - 리소스 로딩(Loading)
    - 페인팅(Painting)
    - 기타

## 13.3.12 Lighthouse Report

- 구글 라이트하우스도 쓸 수 있음
- 크롬개발자랑 달리 일반 모바일 기기 브라우저에서 측정됨

## 13.3.13 기타

WebPageTest 외부에서 제공되는 서비스

- Image Analysis
    - Cloudinary 로 연결
    - 이미지 최적화 예상 결과 알려줌
- Request Map
    - 웹페이지에서 일어나는 요청을 시각화해서 보여줌
    - 리소스 크기와 다른 리소스를 불러오는 연쇄적인 관계를 확인할 수 있음
- Data Cost
    - 국가별로 가장 저렴한 요금제 기준 웹사이트 로딩 시 발생하는 비용 알려줌
- Security Score
    - Synk에서 보안취약점 분석해줌
    - 취약 라이브러리 사용 여부나, 정책 적절성을 평가해줌

---

# 13.4 크롬 개발자 도구

시크릿 모드에서 사용하자

각종 확장프로그램으로 성능 이슈 파악에 방해가 될 수 있음

## 13.4.1 성능 통계

performance로 통합되었다 하네요

## 13.4.2 성능

- 성능 분석에 주로 사용됨
- 성능 측정 기간동안의 네트워크 요청, 메모리 사용량 등 자세한 정보를 확인할 수 있음
- 특정 시점에 대한 정보를 확대해서도 볼 수 있음
- FCP 같은 핵심 웹 지표도 확인할 수 있음
- 시간의 흐름에 따라 메인스레드 작업이 어떻게 이루어졌는지, 자바스크립트 힙 메모리는 어떻게 변화하는지 등을 확인할 수 있음
- 다양한 작업들이 언제 시작했고, 얼마나 시간이 소요되었는지 확인할 수 있음
- 하단 그래프를 통해 자바스크립트 힙, 노드, 리스너 등의 변화를 볼 수 있고, 클릭해보면 당시 발생한 이벤트와 실행된 함수, 스크립트 등을 확인할 수 있음

---

# 13.5 정리

- 성능 개선은 반복적으로 꾸준히 탐색해야 한다