# 12.1 웹사이트와 성능

- 사용자들은 성능에 매우 민감함
- 구식 기술이라도 성능만 충족한다면 사용자는 문제를 느끼지 못함
- 과거에 비해 기기와 네트워크가 발달했지만, 그에 따라 제공하는 정보도 늘어나서 큰 속도 차이를 보여주진 못하고 있음

---

# 12.2 핵심 웹 지표란?

- Core Web Vitals
- 뛰어난 사용자 경험을 제공하는데 필수적인 지표
- 성능 측정을 위한 표준

### 구글에서 꼽는 핵심 지표

- LCP(Largest Contentful Paint) - 최대 콘텐트풀 페인트
- FID(First Input Delay) - 최초 입력 지연
- CLS(Cumulative Layout Shift) - 누적 레이아웃 이동

핵심까지는 아니지만, 특정 문제 진단에 사용될 수 있는 지표

- TTFB(Time To First Byte) - 최초 바이트까지의 시간
- FCP(First Contentful Paint) - 최초 콘텐트풀 시간

---

# 12.3 최대 콘텐트풀 페인트(LCP)

## 12.3.1 정의

- 페이지가 처음 로드를 시작한 시점부터 뷰포트 내부 가장 큰 이미지 또는 텍스트를 렌더링하는데 걸리는 시간
- 뷰포트를 기준으로 측정하며, 뷰포트를 넘어가는 부분은 고려하지 않음
- 사용자 디바이스나, 리소스 사이즈에 따라 지표값이 달라질 수 있음

### 큰 이미지와 텍스트

- `<img>`
- `<svg>` 내부의 `<image>`
- `poster` 속성을 사용하는 `<video>`
- `url()`을 통해 불러온 배경이미지가 있는 요소
- 텍스트와 같이 인라인 텍스트 요소를 포함하고 이쓴 블록 레벨 요소(`<p>`, `<div>` 등)

## 12.3.2 의미

- 사용자에게 로딩이란 뷰포트 영역에 보이는 부분을 기준으로 하기 때문에
- 뷰포트에 메인콘텐츠가 완전히 전달되는 시점
= 사용자가 페이지 로딩이 완료되었다고 생각하는 시점
- 으로 볼 수 있음

## 12.3.3 예제

## 12.3.4 기준 점수

### 측정 방법

- 자바스크립트 API 호출 방식
- 다른 도구 활용

## 12.3.5 개선 방안

- 영역 텍스트로 채우기
- 이미지 로딩 최적화

---

# 12.4 최초 입력 지연(FID)

## 12.4.1 정의

- 웹사이트의 반응 속도
- 사용자가 페이지와 처음 상호작용할 때부터 브라우저가 실제 이벤트 처리를 시작하기까지의 시간
- 최초 입력 하나에 대해서만 판단함

## 12.4.2 의미

- 반응이 늦어지는 이유는 대체로 메인스레드 병목
- FID에서는 주로 클릭/터치/타이핑 등 사용자 개별 입력을 측정함

### 구글의 사용자 경험

크게 4가지로 분류함 → RAIL

- Response: 사용자 입력에 대한 반응속도, 50ms 미만으로 처리할 것
- Animation: 애니메이션 각 프레임을 10ms 이하로 생성할 것
- Idle: 유휴시간을 극대화해 페이지가 50ms이내에 응답하도록 할 것
- Load: 5초 이내에 콘텐츠를 전달하고 인터랙션을 준비할 것

FID는 R(Response)에 초점을 맞추고 있음

## 12.4.3 예제

## 12.4.4 기준 점수

- 100ms 이내면 좋은 점수
- 300ms 이내인 경우 보통
- 그 이후 나쁨으로 처리됨

## 12.4.5 개선 방안

- 긴 작업 분리
- JS 코드 최소화
    - 불필요한 코드 삭제
    - 폴리필 최적화(?)
- 외부 스크립트 지연 불러오기(async, defer)
    - defer: 스크립트를 다른 리소스와 병렬로 다운로드, 페이지 로딩 완료 후 마지막에 실행
    - async: 병렬 다운로드, 다운로드 후 바로 실행
    - 둘 다 없으면: 다운로드가 최우선으로 실행됨, 스레드 블로킹 발생

---

# 12.5 누적 레이아웃 이동(CLS)

## 12.5.1 정의

- 페이지 생명주기 동안 발생하는 모든 예기치 않은 이동에 대한 지표
- 요소들이 움찔거리거나 로딩과정에 레이아웃이 불@쾌하게 변경 되는 경우

## 12.5.2 의미

- 클라이언트에서 처리하는 로직과 UI 변경이 많아지면서 CLS 발생 가능성이 증가함
- 먼저 로딩된 요소를 클릭하려고 할 때 위치가 변경되면서 상호작용이 실패할 수 있음

## 12.5.3 예제

## 12.5.4 기준 점수

- 0.1 이하 좋음
- 0.25 이하 보통
- 이외 나쁨

## 12.5.5 개선 방안

- 삽입이 예상되는 경우 추가 공간 확보
- useLayoutEffect 훅 사용
    - 동기적으로 발생하기 때문에 로딩 지연되지 않도록 주의해야 함
- 스켈레톤 UI
- 폰트 로딩 최적화
- 적절한 이미지 사이즈 설정

## 12.5.6 성능 확인에 중요한 지표들

### TTFB - 최초 바이트까지의 시간

- 브라우저가 웹페이지의 첫번째 바이트를 수신하는데 걸리는 시간
- SSR에서 중요한 지표
- 주요 방문자 국가와 인접한 서버를 사용하는것도 방법
- 스트리밍 API를 활용하는것도 좋음

### FCP - 최초 콘텐트풀 페인트

- 웹사이트 접속이후로 페이지에 뭐라도 뜨기 시작한 시점까지의 시간
- 텍스트, 이미지, SVG 등
- 고려사항
    - TTFB 개선
    - 리소스 최소화 - CSS 등 렌더링을 가로막는 리소스를 최소화, 비동기 로드 활용
    - 최초에 보이는 영역(Above the Fold) 최적화
    - 리다이렉트 최소화
    - DOM 크기 최소화

---

# 12.6 정리

- 요구사항 만족 뿐만 아니라 성능에 대해서도 고민해볼 수 있으면 좋을 것 같음