# 14.1 리액트에서 발생하는 크로스 사이트 스크립팅(XSS)

- XSS는 웹 애플리케이션에서 가장 흔한 취약점
- 웹사이트에 제3자가 악성 스크립트를 삽입해 실행할 수 있는 취약점을 말함
- 게시판과 같이 사용자의 입력을 다른 사용자에게 보여줄 수 있는 경우 발생

## 14.1.1 dangerouslySetInnerHTML prop

- 브라우저 DOM의 innerHTML을 교체할 수 있음
- 게시글(데이터)를 브라우저에 표시할 때 사용함
- 자바스크립트 코드가 들어가면 실행될 수 있음
- 인수로 전달되는 값을 검증하는게 좋음

## 14.1.2 useRef를 활용한 직접 삽입

- useRef로는 DOM에 접근 가능함

## 14.1.3 리액트에서 XSS 문제를 피하는 방법

- Sanitize, Escape - 제3자가 삽입할 수 있는 HTML을 안전한 HTML로 한번 치환 하는 것
- DOMpurify, sanitize-html, js-xss 등의 라이브러리가 있음
- 사용자의 입력을 저장할 때부터 이스케이프 과정을 거치는게 좋음
- DB에 넣는것 부터 위험함
- 이스케이프는 주로 서버에서 진행, 서버 외부의 코드는 모두 위험하다고 간주
- 리액트 자체적으로 기본적인 이스케이프 작업을 해줌
  - dangerouslySetlnnerHTML, props로 넘겨받는 값의 경우 원본 값이 필요할 수도 있어서 이스케이프 안해줌

---

# 14.2 getServerSideProps와 서버컴포넌트를 주의하자

- 서버와 클라이언트가 더욱 가까워짐
- 서버에서만 사용하더 데이터를 클라이언트로 가져오면서 문제가 발생할 수 있음
- 예를들어, 쿠키사용 시 쿠키값을 반환하는게 아닌 토큰값을 파싱해 반환하는 식으로 보안 위협을 줄일 수 있음

---

# 14.3 <a>태그의 값에 적절한 제한을 둬야 한다

- href에 들어갈 수 있는 값을 제한
- origin 검증 로직 추가

---

# 14.4 HTTP 보안 헤더 설정하기

### 보안헤더?

- 렌더링하는 내용과 관련된 보안 취약점을 미연에 방지하기 위해 브라우저와 함께 작동하는 헤더

## 14.4.1 Strict-Transport-Security

- 모든 사이트가 HTTPS를 통해 접근해야 함
- HTTP 접근 시도를 모두 HTTPS로 변경되게 함

## 14.4.2 X-XSS-Protection

- 비표준, 사파리 및 구형 브라우저에서만 제공되는 기능
- XSS 취약점 발견 시 로딩 중단

## 14.4.3 X-Frame-Options

- 페이지를 frame, iframe, embed, object 내부에서 렌더링을 허용할지
- 외부 제3의 페이지에서 다른 페이지를 삽입/실행 해서 악용할 수 있음

## 14.4.4 Permissions-Policy

- 브라우저의 기능이나 API를 선택적으로 활성화/비활성화
- 카메라, geolocation 같은 것들
- 보안 위협에 더불어 사용자 위치정보 수집같은 더 심각한 피해를 방지하기 위함

## 14.4.5 X-Content-Type-Options

- Content-type 헤더에서 제공하는 MIME 유형이 브라우저에 의해 임의로 변경되지 않도록 함

### MIME

- Multipurpose Internet Mail Extentions의 약자
- Content-type의 값으로 사용됨, 전달되는 데이터의 형식을 알려줌
- 원래는 메일 전송에 쓰던 인코딩 방식

## 14.4.6 Referrer-Policy

- HTTP요청의 Referer 헤더는 요청을 보낸 페이지의 주소를 나타냄
- 사용자가 어느 경로로 접근했는지 파악할 수 있음
- Referrer? Referer?
  - Referer이 표준이지만 오타임;
  - 호환성 문제로 수정하지 못함
- 현재 내 페이지에서 다른 페이지로 이동할 때 설정한 정책에 따라 상대 페이지에 정보를 얼마나 넘겨줄 지 정할 수 있음

## 14.4.7 Content-Security-Policy

- `font-src`, `img-src` 등 지시문으로 가녀올 수 있는 리소스를 제한할 수 있음
- `form-action`으로 제출할 수 있는 URL을 제한할 수 있음

## 14.4.8 보안 헤더 설정하기

- Next.js에서는 HTTP 경로별로 보안헤더 설정이 가능함(next.config.js)

## 14.4.9 보안 헤더 확인하기

- [보안 헤더 현황을 알려주느 사이트](https://securityheaders.com)

---

# 14.5 취약점이 있는 패키지의 사용을 피하자

- https://security.snyk.io/ 패키지(라이브러리)의 취약점을 확인해볼 수 있음

---

# 14.6 OWASP Top 10

- Open Worldwide Application Security Project
- 웹에서 발생할 수 있는 위협에 대해 연구함
- 주기적으로 10대 웹 애플리케이션 취약점을 공개함(🔗 [링크](https://owasp.org/www-project-top-ten/))
- 발생 가능한 주요 보안 취약점을 요약해주고, 조치 방법도 소개해줌

---

# 14.7 정리

- 버그 없는 완벽한 소프트웨어는 없다
- 항상 보안 이슈에 귀기울이며 만반의 준비를 갖추어야 신뢰받는 서비스를 만들 수 있다

> 요즘 한창 이슈가 되고 있는 보안문제도 중요하지만, 사실 그냥 단순히 UX만 좋지 못해도 서비스 신뢰도나 만족도는 급격하게 떨어지는 것 같아요..ㅜㅜ
