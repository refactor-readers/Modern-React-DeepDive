# 4장. 서버 사이드 렌더링

## 4.1 서버 사이드 렌더링이란?

### 4.1.1 싱글페이지 애플리케이션의 세상

- 과거의 웹 애플리케이션은 PHP, JSP처럼 서버에서 완성된 HTML을 내려주고 JavaScript는 보조적인 역할만 수행했다
  - 이 방식은 페이지 이동 시마다 HTML을 다시 받아야 했기 때문에 화면 전환이 부자연스럽다는 문제가 있었다
- 이후 사용자 기기 성능과 인터넷 속도가 발전하고, 자바스크립트의 역할이 확장되면서 싱글 페이지 애플리케이션(spa) 이 등장했다
- SPA는 최초 한 번 HTML과 자바스크립트를 내려받은 뒤 페이지 전환을 자바스크립트로 처리하며 필요한 부분만 DOM을 갱신한다
- 이를 통해 매끄러운 UI를 제공할 수 있었지만 초기 로딩 시 대용량 자바스크립트를 파싱해야 한다는 단점이 존재한다

### 4.1.2 서버 사이드 렌더링(SSR)의 개념

- 서버 사이드 렌더링은 최초에 사용자에게 보여줄 페이지를 서버에서 HTML로 완성해 전달하는 방식이다
- SPA와의 가장 큰 차이는 렌더링의 책임이 어디에 있는가이다
  - SPA : 렌더링을 클라이언트가 담당
  - SSR : 렌더링을 서버가 담당
- 이로 인해 SSR은 사용자 기기 성능에 덜 의존하며 초기 화면을 더 빠르게 제공할 수 있다

### 4.1.3 SSR의 장단점

#### | 장점

- 최초 페이지 진입 속도가 빠르다
- 검색 엔진 및 SNS 공유를 위한 메타데이터 제공이 쉽다
- 누적 레이아웃 이동이 적다
- 사용자 디바이스 성능에 비교적 자유롭다
- 클라이언트 코드 노출이 적어 보안에 유리하다

#### | 단점

- 소스 코드 작성 시 서버 환경을 항상 고려해야 한다
- 서버 인프라 구축 및 관리 비용이 필요하다
- 서버 지연이 발생하면 화면 자체가 늦게 표시될 수 있다

### 4.1.4 SPA와 SSR을 함께 알아야 하는 이유

- SSR 역시 만능은 아니라서 페이지 성격에 따라 SPA가 더 적합한 경우도 있고 SSR이 더 나은 사용자 경험을 제공하는 경우도 있다
- 현대의 프레임워크(Next.js, Remix 등)는
- 최초 진입은 SSR 이후 라우팅은 SPA처럼 동작하는 하이브리드 방식을 채택하고 있다

## 4.2 서버 사이드 렌더링을 위한 리액트 API 살펴보기

- 리액트는 서버 환경에서 렌더링을 지원하기 위해 react-dom/server.js API를 제공한다.

### 4.2.1 renderToString

- 리액트 컴포넌트를 HTML 문자열로 변환
- 이벤트 핸들러나 useEffect 같은 클라이언트 로직은 포함되지 않는다
- 루트 엘리먼트(div#root)에 존재하는 속성인 data-reactroot 속성을 통해 hydrate 시 루트 엘리먼트를 식별한다
- 목적 : 초기 HTML을 빠르게 제공

### 4.2.2 renderToStaticMarkup

- renderToString과 HTML을 만드는 점에서 유사하지만 리액트에서만 사용하는 DOM 속성을 만들지 않음
- hydrate를 전제로 하지 않는 완전히 정적인 HTML 생성
- 블로그, 상품 상세 페이지 등 이벤트가 필요 없는 경우에 적합하다

### 4.2.3 renderToNodeStream

- Node.js 환경에서만 사용 가능
- 결과물이 문자열이 아닌 ReadableStream
- HTML을 한 번에 생성하지 않고 청크 단위로 분리해 스트리밍한다
- 대용량 HTML 응답 시 서버 메모리 부담을 줄일 수 있다
- 대부분의 리액트 서버 사이드 렌더링 프레임워크는 모두 renderToString 대신 renderToNodeStream을 채택하고 있다

### 4.2.4 renderToStaticNodeStream

- renderToNodeStream과 유사하지만 hydrate가 필요 없는 순수 HTML 제공
- 정적 페이지에 적합하다

### 4.2.5 hydrate

- 서버에서 생성된 HTML에 이벤트와 자바스크립트 로직을 연결
- 서버 HTML과 클라이언트 렌더링 결과가 일치해야 한다
- 불일치 시 하이드레이션 경고 또는 재렌더링 발생한다

## 4.3 Next.js 톺아보기

- Next.js는 리액트를 기반으로 한 서버 사이드 렌더링 프레임워크이다.

### 4.3.1 Next.js 라우팅

- 최초 페이지 로드는 SSR
- 이후 페이지 이동은 JSON 데이터 기반의 CSR
- next/link는 자동 prefetch를 지원해 빠른 전환 제공
- useRouter 사용 시 prefetch는 직접 설정해야 한다
