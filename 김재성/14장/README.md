# 14장. 웹사이트 보안을 위한 리액트와 웹페이지 보안 이슈


## 14.1 리액트에서 발생하는 크로스 사이트 스크립팅(XSS)
웹사이트 개발자가 아닌 제3자가 웹사이트에 악성 스크립트를 삽입해 실행할 수 있는 취약점을 위미한다. 이 취약점은 일반적으로 게시판과 같이 사용자가 입력을 할 수 있고, 이 입력을 다른 사용자에게 보여줄 수 있는 경우에 발생한다

### 14.1.1 dangerouslySetlnnerHTML prop
특정 브라우저 DOM의 innerHTML을 특정한 내용으로 교체할 수 있는 방법이다. 일반적으로 게시판과 같이 사용자나 관리자가 입력한 내용을 브라우저에 표시하는 용도로 사용된다.

### 14.1.2 useRef를 활용한 직접 삽입
useRef를 활용해서 직접 DOM에 접근할 수 있으므로 이 DOM에 앞서 비슷한 방식으로 innerHTML에 보안 취약점이 있는 스크립트를 삽입하면 동일한 문제가 발생한다

### 14.1.3 리액트에서 XSS 문제를 피하는 방법
제 3자가 삽입할 수 있는 HTML을 안전한 HTML코드로 한 번 치환하는 것이다. 이러한 과정을 새니타이즈(sanitize) 또는 이스케이프(escape)라고 하는데, 새니타이즈를 직접 구현해 사용하는 등 다양한 방법이 있지만 가장 확실한 방법은 npm에 있는 라이브러리를 사용하는 것이다

- DOMpurity
- sanitize-html
- js-xss

## 14.2 getServerSideProps와 서버 컴포넌트를 주의하자
서버 사이드 렌더링과 서버 컴포넌트는 성능 이점을 가져다 줌과 동시에 서버라는 개발 환경을 FE개발자에게 쥐어준 셈이 됐다. 서버에는 일반 사용자에게 노출되면 안 되는 정보들이 담겨 있기 때문에 클라이언트, 즉 브라우저에 정보를 내려줄 때는 조심해야 한다

window.__PRELOADED_STATE__의 값은 XSS에 취약할 수 있기 때문에 반드시 새니타이즈를 거치고, 꼭 필요한 값만 제공해야한다.

## 14.3 a태그의 값에 적절한 제한을 둬야 한다
a태그에 href에 javascript:로 시작하는 코드를 넣으면 페이지 이동을 막고 onClick만 동작하게 되는데 이는 마크업 관점에서 또한 안티패턴이다 a태그는 반드시 페이지 이동이 있을 때만 사용하는 것이 좋다 javascript:뒤에 스크립트코드가 있다면 실행되었을 것이다 페이지 이동없이 onClick만 필요할 경우 button태그를 이용하자

## 14.4 HTTP 보안 헤더 설정하기
브라우저가 렌더링하는 내용과 관련된 보안 취약점을 미연에 방지하기 위해 브라우저와 함께 작동하는 헤더를 의미한다.

### 14.4.1 Strict-Transpot-Security
모든 사이트가 HTTPS를 통해 접근해야 하며, 만약 HTTP로 접근하는 경우 이러한 모든 시도는 HTTPS로 변경되게 한다

### 14.4.2 X-XSS-Protection
비표준 기술로, 현재 사파리와 구형 브라우저에서만 제공되는 기능이다

XSS 취약점이 발견되면 페이지 로딩을 중단하는 헤더다.

### 14.4.3 X-Frame-Options
페이지를 frame, iframe, embed, object 내부에서 렌더링을 허용할지를 나타낼 수 있다

### 14.4.4 Permissions-Policy
웹사이트에서 사용할 수 있는 기능과 사용할 수 없는 기능을 명시적으로 선언하는 헤더다. 개발자는 다양한 브라우저의 기능이나 API를 선택적으로 활성화하거나 필요에 따라서는 비활성화할수도 있다. 여기서 말하는 기능이란 카메라나 GPS와 같이 브라우저가 제공하는 기능을 말한다

### 14.4.5 X-Content-Type-Options
Content-type 헤더에서 제공하는 MIME(jpg, CSS, JSON등)유형이 브라우저에 의해 임의로 변경되지 않게 하는 헤더다. 즉 웹서버가 브라우저에 강제로 이 파일을 읽는 방식을 지정하는 것이다

### 14.4.6 Referrer-Policy
HTTP 요청에는 Referer라는 헤더가 존재하는데, 이 헤더에는 현재 요청을 보낸 페이지의 주소가 나타난다 만약 링크를 통해 들어왔다면 해당 링크를 포함하고 있는 페이지 주소가, 다른 도메인에 요청을 보낸다면 해당 리소스를 사용하는 페이지의 주소가 포함된다. 이 헤더는 사용자가 어디서 와서 방문 중인지 인식할 수 있는 헤더지만, 반대로 사용자 입장에서는 원치않는 정보가 노출될 위험도 존재한다

### 14.4.7 Content-Securiy-Policy
콘텐츠 보안 정책은 XSS공격이나 데이터 삽입 공격과 같은 다양한 보안 위협을 막기 위해 설계됐다.

- *-src(src로 사져올 수 있는 소스를 제한할 수 있다)
- form-action(폼양식으로 제출할 수 있는 URL을 제한할 수 있다)

### 14.4.8 보안 헤더 설정하기

#### nextjs
next.js에서는 보안을 위해 HTTP 경로별로 보안 헤더를 적용할 수 있다

next.config.js에서 가능

#### nginx
정적인 파일을 제공하는 nginx의 경우 add_header 지시자를 사용해 원하는 응답 헤더를 추가할 수 있다

### 14.4.9 보안 헤더 확인하기
https://securityheaders.com/ 를 통해 확인해 볼 수 있다

## 14.5 취약점이 있는 패키지의 사용을 피하자

## 14.6 OWASP Top 10
Open Worldwide Application Security Project라는 오픈소스 웹 애플리케이션 보안 프로젝트를 의미한다. 주로 웹에서 발생할 수 있는 정보 노출, 악성 스크립트, 보안 취약점 등을 연구하며, 주기적으로 10대 웹 애플리케이션 취약점을 공개하는데 이를 OWASP Top 10이라고 한다. 매번 보안 취약점의 빈도에 따라 순위를 매기며, 이 순위는 발표마다 조금씩 바뀐다