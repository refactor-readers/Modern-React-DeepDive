# 07. 크롬 개발자 도구를 활용한 애플리케이션 분석

- 자바스크립트 메모리, 네트워크, 소스, 실제 HTML 및 CSS 등 리액트가 아닌 일반적인 웹 애플리케이션 환경의 디버깅을 수행하려면 리액트 개발 도구가 아닌 좀 더 실용적인 도구를 활용해야 합니다.

## 07.1. 크롬 개발자 도구란?

- 크롬 개발자 도구를 제대로 사용하고 싶다면 시크릿 혹은 프라이빗 모드인 개인정보 보호 모드에서 페이지와 개발자 도구를 여는 것을 권장드립니다.
- 브라우저 확장 프로그램으로 인해 웹 페이지 방문 시 전역 변수 혹은 HTML 요소에 실제 웹 애플리케이션이 제공하지 않은 다른 정보를 추가해놓을 수 있기 때문입니다.
  - 그리고 이러한 정보는 개발자가 추가한 정보가 아닐뿐더러 다른 사용자에게서는 볼 수 없는 정보로서 디버깅하는 데 방해가 될 수 있기 때문입니다.

## 07.2. 요소 탭

### 07.2.1. 요소 화면

- 요소 화면에서는 단순히 현재 HTML을 보는 것뿐만 아니라 수정하고 싶은 요소를 더블클릭하여 태그명 혹은 클래스 등 요소와 관련된 정보를 수정하거나, 오른쪽 화면에서 스타일을 수정할 수도 있습니다.
- 만약 배너와 같이 코드에 의해 클래스나 속성값이 동적으로 제어되는 DOM이 있다면 요소의 중단점을 디버깅할 수 있습니다.
  - 먼저 디버깅하고 싶은 요소를 선택하고 마우스 오른쪽 버튼을 클릭한 후 중단위치를 선택하고 중단을 원하는 옵션을 클릭하시면 됩니다.
  - 이렇게 중단위치를 설정해 두면 중단과 관련된 작업이 일어날 대마다 브라우저가 렌더링을 중단하고 해당 요소 변경을 일으킨 소스코드를 보여주게 됩니다.

## 07.3. 소스 탭

- 소스 탭에서는 웹 애플리케이션을 불러오기 위해 실행하거나 참조된 모든 파일을 확인할 수 있습니다.
- 소스 탭의 장점은 단순히 파일을 볼 수 있다는 부분 이외에도 여러가지 기능이 존재합니다.
  - 앞서 요소 탭에서 DOM 중단점을 만들어 DOM이 변경되는 과정을 디버깅해 볼 수 있었던 것과 마찬가지로 여기서도 소스 중단점을 생성하여 자바스크립트 실행을 중단시키고 디버깅을 수행할 수 있습니다.
  - 코드상에 debugger를 선언하는 것과 동일한 역할을 하지만 해당 요소 탭에서 작업한다면 소스코드를 오염시키지 않으므로 더 유용합니다.
  - 만약 본인이 작성한 파일 이외에 다른 곳, 예를 들어 리액트 파일 내에서 중단점을 생성해 보고 싶다면 해당 소스 파일을 찾아 중단점을 걸어볼 수도 있습니다.
- 소스 탭에서 제공하는 다른 기능도 정리해보자

  - 감시: 감시는 말 그대로 감시하고 싶은 변수를 선언하고, 해당 변수의 정보를 확인할 수 있는 메뉴입니다. 왼쪽에서 제공하는 변수 외에 디버깅 시점에서 특정 변수의 값을 알고 싶다면 이 감시를 활용하면 됩니다.
    - 감시 메뉴에서는 개발자가 추적하고 싶은 변수를 적어두고 현재 값이 무엇인지 실시간으로 확인할 수 있습니다.
  - 중단점: 현재 웹사이트에서 추가한 중단점을 확인할 수 있습니다. 열려 있는 파일뿐만 아니라 웹페이지 전체에 걸쳐 소스 탭에서 추가한 모든 중단점을 확인할 수 있습니다.
  - 범위: 범위는 이름 그대로 현재 중단점에서의 스코프를 의미합니다. 로컬은 현재 로컬 스코프를 의미하며, 이 스코프에서 접근할 수 있는 값을 확인할 수 있습니다. 이 밖에도 클로저, 전역 스코프 등을 확인할 수 있습니다.
  - 호출 스택: 호출 스택에서는 현재 중단점의 콜스택을 확인할 수 있습니다. 이 메뉴를 활용하면 자바스크립트 코드가 실행되며 생성되는 실행 콘텍스트가 어떻게 저장되어 현재 어떤 모습을 하고 있는지 직접 볼 수 있습니다.
  - 전역 리스너: 현재 전역 스코프에 추가된 리스너 목록을 확인할 수 있습니다.
  - XHR/가져오기, DOM, 이벤트 리스너, CSP 위반 중단점: 소스의 중단점 이외에 다양한 중단점을 확인할 수 있습니다.

- 이처럼 소스 탭에서는 애플리케이션을 실제로 실행하는데 사용된 파일을 직접 볼 수 있을뿐만 아니라 중단점을 설정해 두면 빌드된 자바스크립트 또는 실제 개발중인 스크립트 파일이 어떻게 실행되는지 눈으로 확인할 수 있습니다.
- 또한 자바스크립트 파일에서는 확인할 수 없는 스코프, 호출 스택,등 현재 자바스크립트가 실행되고 있는 구조도 확인할 수 있어 유용합니다.

## 07.4. 네트워크 탭

- 네트워크 탭에서는 해당 페이지를 접속하는 순간부터 발생하는 모든 네트워크 관련 동작이 기록됩니다.
- 웹사이트에서 자주 사용하는 HTTP 요청부터 웹 소켓에 이르기까지, 웹페이지가 외부 데이터와 통신하는 정보를 확인하고 싶다면 네트워크 탭을 참조하면 됩니다.
- 네트워크 탭을 통해 집중적으로 확인해 봐야 하는 점은 다음과 같습니다.
  - 불필요한 요청 또는 중복되는 요청이 없는지
  - 웹페이지 구성에 불필요한 리소스 크기가 너무 크지 않은지
  - 리소스를 불러오는 속도는 적절한지 또는 너무 속도가 오래 걸리는 리소스는 없는지
  - 리소스가 올바른 우선순위로 다운로드되어 페이지를 자연스럽게 만들어가는지

## 07.5. 메모리 탭

- 메모리 탭은 크롬 개발자 도구에서 제공하는 도구 중 가장 난이도가 높고 까다롭지만, 애플리케이션에서 발생하는 메모리 누수, 속도 저하, 혹은 웹페이지 프리징 현상을 확안할 수 있는 유용한 도구입니다.
- 메모리 탭을 열면 리액트 개발 도구의 프로파일과 비슷하게 프로파일링 작업을 거쳐야 원하는 정보를 확인할 수 있습니다.
- 다른 크롬 개발자 도구인 요소나 다른 탭과는 다르게 메모리 탭 그 자체만으로는 아무것도 할 수 없습니다.
- 프로파일 유형이 크게 세 가지가 있는제 각 프로파일링의 유형은 다음과 같습니다.
  - 힙 스냅샷: 스냅샷이라는 이름에 걸맞게 현재 메모리 상황을 사진 찍듯이 촬영할 수 있습니다. 현재 시점의 메모리 상황을 알고싶다면 힙 스냅샷을 활용하면 됩니다.
  - 타임라인의 할당 계측: 현재 시점의 메모리 상황이 아닌, 시간의 흐름에 다라 메모리의 변화를 살펴보고 싶다면 타임라인의 할당 계측을 사용하면 됩니다. 주로 로딩이 되는 과정의 메모리 변화 또는 페이지에서 어떠한 상호작용을 했을 때 메모리의 변화 과정을 알고 싶을 때 사용합니다.
  - 할당 샘플링: 메모리 공간을 차지하고 있는 자바스크립트 함수를 확인할 수 있습니다.

### 07.5.1. 자바스크립트 인스턴스 VM 선택

- 개발자가 디버깅하고 싶은 자바스크립트 VM 환경을 선택하면 환경별 힙 크기를 확인할 수 있는데, 실제 해당 페이지가 자바스크립트 힙을 얼마나 점유하고 있는지를 나타냅니다.
- 이 크기는 자바스크립트 실행에 따라 실시간으로 변경됩니다.

### 07.5.2. 힙 스냅샷

- 힙 스냅샷은 현재 페이지의 메모리 상태를 확인해 볼 수 있는 메모리 프로파일 도구입니다.
- 이후 설명할 두 가지 도구와는 다르게, 힙 스냅샷을 촬영하는 시점을 기준으로 마치 사진으로 촬영하듯 메모리 현황을 보여줍니다.

## 07.6. Next.js 환경 디버깅하기

- 만약 서버사이드 렌더링을 수행하는 자바스크립트 환경에서 메모리 누수가 발생한다면 어떻게 될까요? 메모리 누수로 인해 서버 자체에 부담이 발생하게 될 것입니다.
- 하지만 서버 환경도 동일하게 크롬 개발자 도구에서 디버깅이 가능합니다. 이번 챕터에서는 Node.js환경인 서버 환경을 디버깅하는 방법을 살펴보겠습니다.

### 07.6.1. Next.js 프로젝트를 디버그 모드로 실행하기

- 브라우저에서 발생하는 메모리 누수의 경우 사용자가 웹페이지에서 이용할 수 있는 몇 가지 시나리오를 흉내내면서 메모리 누수 여부를 확인할 수 있었습니다.
- 그러나 서버 사이드 렌더링과 같이 서버에서 제공되는 서비스의 경우 서버를 실행한 뒤 사용자가 서서히 유입되면서 메모리 누수가 발생하는 경우가 많습니다.
- 따라서 서버에 직접 트래픽을 발생시켜 확인하는 편이 가장 확실한 방법 입니다.
- 디버그 모드로 Next.js를 실행했다면 이제 사용자의 트래픽이 서버로 몰리는 상황을 시뮬레이션 해보면 됩니다.
  - 새로고침이나 다른 컴퓨터를 이용해서 접속하는 것보다 더 편리한 방법은 오픈소스를 사용하는 것 입니다.
  - `ab`는 아파치 대잔에서 제공하는 웹서버 성능 검사 도구로, HTTP 서버의 성능을 벤치마킹할 수 있는 도구입니다.
    - 디버그 모드의 IP주소로 특정 요청을 50번씩 총 10000회 시도하는 등의 테스트가 가능해집니다.
  - `ab`를 사용하면 단순히 요청을 수행하는 것뿐만 아니라 요청으로부터 응답받는데 걸린 시간, 바이트 크기 등 다양한 정보를 확인할 수 있습니다.

### 07.6.3. Next.js의 메모리 누수 지점 확인하기

- serverFunction을 메모리 도구로 프로파일링 할 수 있으며, 페이지 접근 요청이 있을 때마다 샐행되는 함수 등은 최대한 부수 효과가 없는 순수 함수로 만들어주어야 합니다.
